{"version":3,"file":"plugin.cjs.js","sources":["esm/plugin.js","esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin, Capacitor } from '@capacitor/core';\nconst ElkeBatteryNative = registerPlugin('ElkeBattery', {\n    web: () => import('./web').then((m) => new m.ElkeBatteryWeb()),\n});\n// Simplified wrapper to handle native events properly\nexport class ElkeBatteryWrapper {\n    constructor() {\n        this.listeners = new Map();\n        this.nativeListenerHandle = null;\n    }\n    async getBatteryInfo() {\n        return ElkeBatteryNative.getBatteryInfo();\n    }\n    async addBatteryListener(callback) {\n        const callbackId = this.generateCallbackId();\n        this.listeners.set(callbackId, callback);\n        // For native platforms, use Capacitor's event system\n        if (Capacitor.isNativePlatform()) {\n            if (!this.nativeListenerHandle) {\n                // Listen for native events using Capacitor's event system\n                this.nativeListenerHandle = await ElkeBatteryNative.addListener('batteryChanged', (data) => {\n                    console.log('Native battery event received:', data);\n                    // Notify all registered listeners\n                    this.listeners.forEach(cb => cb(data));\n                });\n                console.log('Capacitor event listener setup complete');\n            }\n            // Call the native method to start the battery receiver\n            try {\n                await ElkeBatteryNative.addBatteryListener(() => { });\n                console.log('Native battery receiver started');\n            }\n            catch (error) {\n                console.error('Native battery listener setup error:', error);\n            }\n        }\n        else {\n            // For web, use the original implementation\n            const result = await ElkeBatteryNative.addBatteryListener(callback);\n            return result.value;\n        }\n        return callbackId;\n    }\n    async removeBatteryListener(callbackId) {\n        this.listeners.delete(callbackId);\n        if (!Capacitor.isNativePlatform()) {\n            return ElkeBatteryNative.removeBatteryListener(callbackId);\n        }\n        // For native, if no more listeners, clean up the native listener\n        if (this.listeners.size === 0) {\n            try {\n                await ElkeBatteryNative.removeBatteryListener(callbackId);\n                if (this.nativeListenerHandle) {\n                    await this.nativeListenerHandle.remove();\n                    this.nativeListenerHandle = null;\n                }\n                console.log('Native listener cleaned up');\n            }\n            catch (error) {\n                console.error('Error cleaning up native listener:', error);\n            }\n        }\n    }\n    generateCallbackId() {\n        return Math.random().toString(36).substr(2, 9);\n    }\n}\n//# sourceMappingURL=plugin.js.map","import { ElkeBatteryWrapper } from './plugin';\nconst ElkeBattery = new ElkeBatteryWrapper();\nexport * from './definitions';\nexport { ElkeBattery };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nexport class ElkeBatteryWeb extends WebPlugin {\n    constructor() {\n        super();\n        this.batteryListeners = new Map();\n        this.eventListeners = new Map();\n    }\n    async getBatteryInfo() {\n        var _a, _b;\n        if (!this.batteryAPI) {\n            // @ts-ignore\n            this.batteryAPI = await ((_b = (_a = navigator).getBattery) === null || _b === void 0 ? void 0 : _b.call(_a));\n        }\n        if (this.batteryAPI) {\n            const level = Math.round(this.batteryAPI.level * 100);\n            const isCharging = this.batteryAPI.charging;\n            const isLowBattery = level < 20;\n            let status = 'unknown';\n            if (isCharging) {\n                status = level === 100 ? 'full' : 'charging';\n            }\n            else {\n                status = 'discharging';\n            }\n            return {\n                level,\n                isCharging,\n                isLowBattery,\n                status\n            };\n        }\n        // Fallback for browsers that don't support Battery API\n        return {\n            level: 100,\n            isCharging: false,\n            isLowBattery: false,\n            status: 'unknown'\n        };\n    }\n    async addBatteryListener(callback) {\n        var _a, _b;\n        const callbackId = this.generateCallbackId();\n        this.batteryListeners.set(callbackId, callback);\n        if (!this.batteryAPI) {\n            // @ts-ignore\n            this.batteryAPI = await ((_b = (_a = navigator).getBattery) === null || _b === void 0 ? void 0 : _b.call(_a));\n        }\n        if (this.batteryAPI) {\n            const updateCallback = () => {\n                this.getBatteryInfo().then(info => callback(info));\n            };\n            // Store the actual event listener functions for proper cleanup\n            this.eventListeners.set(callbackId + '_charging', updateCallback);\n            this.eventListeners.set(callbackId + '_level', updateCallback);\n            this.batteryAPI.addEventListener('chargingchange', updateCallback);\n            this.batteryAPI.addEventListener('levelchange', updateCallback);\n        }\n        return { value: callbackId };\n    }\n    async removeBatteryListener(callbackId) {\n        this.batteryListeners.delete(callbackId);\n        // Remove the actual event listeners from the battery API\n        if (this.batteryAPI) {\n            const chargingListener = this.eventListeners.get(callbackId + '_charging');\n            const levelListener = this.eventListeners.get(callbackId + '_level');\n            if (chargingListener) {\n                this.batteryAPI.removeEventListener('chargingchange', chargingListener);\n                this.eventListeners.delete(callbackId + '_charging');\n            }\n            if (levelListener) {\n                this.batteryAPI.removeEventListener('levelchange', levelListener);\n                this.eventListeners.delete(callbackId + '_level');\n            }\n        }\n    }\n    generateCallbackId() {\n        return Math.random().toString(36).substr(2, 9);\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","Capacitor","WebPlugin"],"mappings":"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"}