{"version":3,"file":"plugin.js","sources":["esm/plugin.js","esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin, Capacitor } from '@capacitor/core';\nconst ElkeBatteryNative = registerPlugin('ElkeBattery', {\n    web: () => import('./web').then((m) => new m.ElkeBatteryWeb()),\n});\n// Simplified wrapper to handle native events properly\nexport class ElkeBatteryWrapper {\n    constructor() {\n        this.listeners = new Map();\n        this.nativeListenerHandle = null;\n    }\n    async getBatteryInfo() {\n        return ElkeBatteryNative.getBatteryInfo();\n    }\n    async addBatteryListener(callback) {\n        const callbackId = this.generateCallbackId();\n        this.listeners.set(callbackId, callback);\n        // For native platforms, use Capacitor's event system\n        if (Capacitor.isNativePlatform()) {\n            if (!this.nativeListenerHandle) {\n                // Listen for native events using Capacitor's event system\n                this.nativeListenerHandle = await ElkeBatteryNative.addListener('batteryChanged', (data) => {\n                    console.log('Native battery event received:', data);\n                    // Notify all registered listeners\n                    this.listeners.forEach(cb => cb(data));\n                });\n                console.log('Capacitor event listener setup complete');\n            }\n            // Call the native method to start the battery receiver\n            try {\n                await ElkeBatteryNative.addBatteryListener(() => { });\n                console.log('Native battery receiver started');\n            }\n            catch (error) {\n                console.error('Native battery listener setup error:', error);\n            }\n        }\n        else {\n            // For web, use the original implementation\n            const result = await ElkeBatteryNative.addBatteryListener(callback);\n            return result.value;\n        }\n        return callbackId;\n    }\n    async removeBatteryListener(callbackId) {\n        this.listeners.delete(callbackId);\n        if (!Capacitor.isNativePlatform()) {\n            return ElkeBatteryNative.removeBatteryListener(callbackId);\n        }\n        // For native, if no more listeners, clean up the native listener\n        if (this.listeners.size === 0) {\n            try {\n                await ElkeBatteryNative.removeBatteryListener(callbackId);\n                if (this.nativeListenerHandle) {\n                    await this.nativeListenerHandle.remove();\n                    this.nativeListenerHandle = null;\n                }\n                console.log('Native listener cleaned up');\n            }\n            catch (error) {\n                console.error('Error cleaning up native listener:', error);\n            }\n        }\n    }\n    generateCallbackId() {\n        return Math.random().toString(36).substr(2, 9);\n    }\n}\n//# sourceMappingURL=plugin.js.map","import { ElkeBatteryWrapper } from './plugin';\nconst ElkeBattery = new ElkeBatteryWrapper();\nexport * from './definitions';\nexport { ElkeBattery };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nexport class ElkeBatteryWeb extends WebPlugin {\n    constructor() {\n        super();\n        this.batteryListeners = new Map();\n        this.eventListeners = new Map();\n    }\n    async getBatteryInfo() {\n        var _a, _b;\n        if (!this.batteryAPI) {\n            // @ts-ignore\n            this.batteryAPI = await ((_b = (_a = navigator).getBattery) === null || _b === void 0 ? void 0 : _b.call(_a));\n        }\n        if (this.batteryAPI) {\n            const level = Math.round(this.batteryAPI.level * 100);\n            const isCharging = this.batteryAPI.charging;\n            const isLowBattery = level < 20;\n            let status = 'unknown';\n            if (isCharging) {\n                status = level === 100 ? 'full' : 'charging';\n            }\n            else {\n                status = 'discharging';\n            }\n            return {\n                level,\n                isCharging,\n                isLowBattery,\n                status\n            };\n        }\n        // Fallback for browsers that don't support Battery API\n        return {\n            level: 100,\n            isCharging: false,\n            isLowBattery: false,\n            status: 'unknown'\n        };\n    }\n    async addBatteryListener(callback) {\n        var _a, _b;\n        const callbackId = this.generateCallbackId();\n        this.batteryListeners.set(callbackId, callback);\n        if (!this.batteryAPI) {\n            // @ts-ignore\n            this.batteryAPI = await ((_b = (_a = navigator).getBattery) === null || _b === void 0 ? void 0 : _b.call(_a));\n        }\n        if (this.batteryAPI) {\n            const updateCallback = () => {\n                this.getBatteryInfo().then(info => callback(info));\n            };\n            // Store the actual event listener functions for proper cleanup\n            this.eventListeners.set(callbackId + '_charging', updateCallback);\n            this.eventListeners.set(callbackId + '_level', updateCallback);\n            this.batteryAPI.addEventListener('chargingchange', updateCallback);\n            this.batteryAPI.addEventListener('levelchange', updateCallback);\n        }\n        return { value: callbackId };\n    }\n    async removeBatteryListener(callbackId) {\n        this.batteryListeners.delete(callbackId);\n        // Remove the actual event listeners from the battery API\n        if (this.batteryAPI) {\n            const chargingListener = this.eventListeners.get(callbackId + '_charging');\n            const levelListener = this.eventListeners.get(callbackId + '_level');\n            if (chargingListener) {\n                this.batteryAPI.removeEventListener('chargingchange', chargingListener);\n                this.eventListeners.delete(callbackId + '_charging');\n            }\n            if (levelListener) {\n                this.batteryAPI.removeEventListener('levelchange', levelListener);\n                this.eventListeners.delete(callbackId + '_level');\n            }\n        }\n    }\n    generateCallbackId() {\n        return Math.random().toString(36).substr(2, 9);\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","Capacitor","WebPlugin"],"mappings":"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"}